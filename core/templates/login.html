{% extends "base.html" %}
{% load i18n %}

{% block content %}

<form method="post" action=".">
    {% csrf_token %}
    {{ wizard.management_form }}
    {% if wizard.steps.current == 'auth' %}
        <div class="login__step-title">
            <div>
                <h2>{% trans "Sign in" %}</h2>
                <p>{% trans "with your Pleio-account" %}</p>
            </div>
            <img src="/static/images/logo-icon.svg" class="login__step-icon"/>
        </div>
        
        <ul class="messages error">
            {% for error in form.non_field_errors %}
                <li>{{ error }}</li>
            {% endfor %}
        </ul>

        <fieldset>
            <div class="input-field">
                <label for="id_auth-username">{% trans "Email address" %}</label>
                {{ form.errors.username }}
                {{ form.username }}
            </div>
            <div class="input-field">
                <label for="id_auth-password">{% trans "Password" %}</label>
                {{ form.errors.password }}
                {{ form.password }}
                <a href="{% url 'password_reset' %}" class="forgot-password">{% trans "Forgot password" %}?</a>
            </div>

            <!-- <div class="login__check">
                {{ form.errors.is_persistent }}
                {{ form.is_persistent }}
                <label for="id_auth-is_persistent">{% trans "Remember me" %}</label>
            </div> -->

            <div class="login__buttons">
                <button name="login" class="button ___stretch ___active login__login" type="submit">{% trans "Login" %}</button>
                <a href="{% url 'register' %}" class="button ___stretch ___white ___outline">{% trans "Register account" %}</a>
            </div>
        </fieldset>
        <input type="hidden" name="next" value="{{next}}" />
        <p></p>
        
        <ul class="messages info">
            <li class="messages__link">
                <a href="/link/">
                    <div class="textcolor_primary">{% trans "Secure your account" %}</div>
                    <div class="textcolor_secondary">{% trans "Enable two factor authentication" %}</div>
                </a>
            </li>
        </ul>
    {% elif wizard.steps.current == 'token' %}

    <script type="text/javascript">
      window.onload = function() {
         {
          document.getElementById("id_token-otp_token").focus();
        }
      };
    </script>
    
    <ul class="messages info">
        <li class="messages__link">
            <a href="/link/">
                <div class="textcolor_primary">{% trans "Two factor authentication" %}</div>
                <div class="textcolor_secondary">{% trans "Fill in a code from your code generator." %}</div>
            </a>
        </li>
    </ul>
    
    <fieldset>
        <div class="input-field">
            {{ form.errors.otp_token }}
            {{ form.otp_token.label_tag }}
            {{ form.otp_token }}
        </div>
        <div class="login__buttons">
            <button class="button ___stretch ___active login__login" type="submit">{% trans "Login" %}</button>
            <a href="{% url 'login' %}" class="button ___stretch ___white ___outline">{% trans "Cancel" %}</a>
        </div>
    </fieldset>
    {% elif wizard.steps.current == 'backup' %}
    <script type="text/javascript">
      window.onload = function() {
         {
          document.getElementById("id_backup-otp_token").focus();
        }
      };
    </script>
    <p>{% blocktrans %}Use this form for entering backup tokens for logging in.
         These tokens have been generated for you to print and keep safe. Please
             enter one of these backup tokens to login to your account.{% endblocktrans %}</p>
         <fieldset>
             <div class="input-field">
                 <label for="id_backup-otp_token">Token:</label>
                 <input id="id_backup-otp_token" name="backup-otp_token" type="text">
             </div>
         </fieldset>
        <div class="login__buttons">
            <button name="wizard_goto_step" type="submit" class="button ___stretch ___active">{% trans "Use backuptoken" %}</button>
            <button name="wizard_goto_step" type="submit" value="auth" class="button ___stretch ___white ___outline">{% trans "Back" %}</button>
        </div>

    {% endif %}
        {% if backup_tokens %}
      <p>{% trans "As a last resort, you can use a backup token:" %}</p>
        <div class="input-field">
            <button name="wizard_goto_step" type="submit" value="backup" class="button ___stretch ___active">{% trans "Use backuptoken" %}</button>
            <button name="wizard_goto_step" type="submit" value="auth" class="button ___stretch ___white ___outline">{% trans "Back" %}</button>
        </div>

    {% endif %}

</form>
{% endblock %}

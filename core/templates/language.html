
{% load i18n %}

<a href="{{ current_path }}" class="ui primary button compact" onclick="changeLanguage();" id='btn' title="{% trans "Change language" %}">
      {% if request.COOKIES.lang == 'en'%}
        <span aria-hidden="true">FR</span>
        <span class="invisible" lang="fr">Fran√ßais</span>
      {% else %}
        <span aria-hidden="true">EN</span>
        <span class="invisible" lang="en">English</span>
      {% endif %}
    </a>

<script>
function getCookie(cname) {
    var lang = "";
    var name = cname + "=";
    var decodedCookie = decodeURIComponent(document.cookie);
    var ca = decodedCookie.split(';');
    for(var i = 0; i <ca.length; i++) {
        var c = ca[i];
        while (c.charAt(0) == ' ') {
            c = c.substring(1);
        }
        if (c.indexOf(name) == 0) {
            //return c.substring(name.length, c.length);
            lang = c.substring(name.length, c.length);
        }
    }
    return lang;
}

function changeLanguage() {
    var hostname = location.hostname;
    var length = hostname.split(".").length - 1;
    var domain = (length >= 2) ? '.' + location.hostname.split('.').slice(-2).join('.') : '';
    if (getCookie('lang') == 'en') {
        setCookie("lang", 'fr', '', '/', domain);
    } else {
        setCookie("lang", 'en', '', '/', domain);
    }
}

function setCookie(sName, sValue, oExpires, sPath, sDomain, bSecure) {
    var sCookie = sName + "=" + encodeURIComponent(sValue);
    if (oExpires) {
        sCookie += "; expires=" + oExpires.toGMTString();
    }
    if (sPath) {
        sCookie += "; path=" + sPath;
    }
    if (sDomain) {
        sCookie += "; domain=" + sDomain;
    }
    if (bSecure) {
        sCookie += "; secure";
    }
    document.cookie = sCookie;

    $.ajax({
        type: "POST",
        url: "{% url 'set_language' %}",
        data: {'language': sValue, 'csrfmiddlewaretoken': '{{ csrf_token }}'},
        success: function(response) {},
        error: function(rs, e) { console.log(e); }
    });

}
</script>
